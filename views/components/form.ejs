<%
const method = component.config.method || 'POST';
const action = component.config.action || '/contact';
const fields = component.config.fields || [];
const submitButtonKey = component.config.submit_button_key || '';
const submitButtonText = submitButtonKey ? textContent[submitButtonKey] : 'Submit';
const styleStr = Object.entries(component.styles).map(([key, value]) => key.replace(/([A-Z])/g, '-$1').toLowerCase() + ': ' + value).join('; ');
%>

<div class="component component-form" style="<%= styleStr %>">
    <form method="<%= method %>" action="<%= action %>" class="contact-form" id="contactForm">
        <% fields.forEach(function(field) { %>
            <div class="form-group">
                <label for="<%= field.name %>">
                    <%= field.label_key ? textContent[field.label_key] : field.label %>
                    <% if (field.required) { %><span class="required">*</span><% } %>
                </label>
                <% if (field.type === 'textarea') { %>
                    <textarea 
                        id="<%= field.name %>" 
                        name="<%= field.name %>" 
                        <%= field.required ? 'required' : '' %>
                        rows="5"
                    ></textarea>
                <% } else { %>
                    <input 
                        type="<%= field.type || 'text' %>" 
                        id="<%= field.name %>" 
                        name="<%= field.name %>" 
                        <%= field.required ? 'required' : '' %>
                    >
                <% } %>
            </div>
        <% }); %>
        
        <div class="form-group">
            <button type="submit" class="btn btn-primary"><%= submitButtonText %></button>
        </div>
        
        <div class="form-message" id="formMessage" style="display: none;"></div>
    </form>
</div>

<script>
document.getElementById('contactForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const form = e.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    const messageEl = document.getElementById('formMessage');
    
    try {
        const response = await fetch(form.action, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        messageEl.textContent = result.message;
        messageEl.className = 'form-message ' + (result.success ? 'success' : 'error');
        messageEl.style.display = 'block';
        
        if (result.success) {
            form.reset();
        }
    } catch (error) {
        messageEl.textContent = 'An error occurred. Please try again.';
        messageEl.className = 'form-message error';
        messageEl.style.display = 'block';
    }
});
</script>
